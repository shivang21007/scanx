<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" 
           Name="ScanX" 
           Language="1033" 
           Version="1.0.0" 
           Manufacturer="Your Company" 
           UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perMachine"
             Description="ScanX - System Monitoring and Device Management" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- Features -->
    <Feature Id="ProductFeature" Title="ScanX" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="ConfigFiles" />
      <ComponentRef Id="ConfigScript" />
      <ComponentRef Id="ServiceComponent" />
    </Feature>

    <!-- Directory Structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="scanx">
          <Directory Id="ConfigFolder" Name="config" />
          <Directory Id="LogsFolder" Name="logs" />
        </Directory>
      </Directory>
    </Directory>

    <!-- Main Executable -->
    <Component Id="MainExecutable" Directory="INSTALLFOLDER" Guid="11111111-1111-1111-1111-111111111111">
      <File Id="scanx.exe" Source="C:\Users\Octro\Downloads\scanx\agent\dist\builds\scanx-windows-amd64.exe" KeyPath="yes" />
    </Component>
    
    <!-- Config Files -->
    <Component Id="ConfigFiles" Directory="ConfigFolder" Guid="22222222-2222-2222-2222-222222222222">
      <File Id="agent.conf" Source="C:\Users\Octro\Downloads\scanx\agent\config\agent.conf" />
      <File Id="queries.yml" Source="C:\Users\Octro\Downloads\scanx\agent\config\queries.yml" />
    </Component>

    <!-- Service Component -->
    <Component Id="ServiceComponent" Directory="INSTALLFOLDER" Guid="33333333-3333-3333-3333-333333333333">
      <CreateFolder />
      <ServiceInstall Id="scanxService"
                      Type="ownProcess"
                      Name="scanx"
                      DisplayName="ScanX - System Monitoring"
                      Description="ScanX - System Monitoring and Device Management Service"
                      Start="auto"
                      Account="LocalSystem"
                      ErrorControl="ignore"
                      Interactive="no"
                      Arguments="-daemon">
        <ServiceDependency Id="Tcpip" />
      </ServiceInstall>
      
      <ServiceControl Id="StartService" 
                      Start="install" 
                      Stop="both" 
                      Remove="uninstall" 
                      Name="scanx" 
                      Wait="no" />
    </Component>

    <!-- License -->
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf" />
    
    <!-- UI -->
    <UI>
      <UIRef Id="WixUI_Minimal" />
    </UI>

    <!-- Properties -->
    <Property Id="COLLECTION_INTERVAL" Value="2h" />
    
    <!-- Include PowerShell script for configuration -->
    <Component Id="ConfigScript" Directory="INSTALLFOLDER" Guid="44444444-4444-4444-4444-444444444444">
      <File Id="configure_scanx_v1_ps1" Source="configure-scanx-v1.ps1" />
    </Component>

  </Product>
</Wix>
